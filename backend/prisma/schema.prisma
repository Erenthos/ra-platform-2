// =======================================================
// REVERSE AUCTION PLATFORM â€” FINAL PRISMA SCHEMA
// Compatible with Neon (PostgreSQL) lowercase tables
// =======================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =======================================================
// USERS TABLE (maps to "public.users")
// =======================================================
model User {
  id        Int       @id @default(autoincrement()) @map("id")
  name      String    @map("name")
  email     String    @unique @map("email")
  password  String    @map("password")
  role      String    @map("role")
  createdAt DateTime  @default(now()) @map("created_at")

  // Relations
  auctions  Auction[] @relation("BuyerAuctions")
  bids      Bid[]

  @@map("users") // ðŸ‘ˆ explicit mapping to lowercase table
}

// =======================================================
// AUCTIONS TABLE (maps to "public.auctions")
// =======================================================
model Auction {
  id          Int       @id @default(autoincrement()) @map("id")
  title       String    @map("title")
  description String?   @map("description")
  startsAt    DateTime  @map("starts_at")
  endsAt      DateTime  @map("ends_at")
  createdAt   DateTime  @default(now()) @map("created_at")

  // Buyer relation
  buyer     User     @relation("BuyerAuctions", fields: [buyerId], references: [id])
  buyerId   Int      @map("created_by")

  bids      Bid[]
  items     Item[]

  @@map("auctions")
}

// =======================================================
// BIDS TABLE (maps to "public.bids")
// =======================================================
model Bid {
  id          Int       @id @default(autoincrement()) @map("id")
  totalValue  Float     @map("total_value")
  submittedAt DateTime  @default(now()) @map("submitted_at")

  // Relations
  auction     Auction   @relation(fields: [auctionId], references: [id])
  auctionId   Int       @map("auction_id")

  supplier    User      @relation(fields: [supplierId], references: [id])
  supplierId  Int       @map("supplier_id")

  @@unique([auctionId, supplierId], name: "auctionId_supplierId")
  @@map("bids")
}

// =======================================================
// ITEMS TABLE (maps to "public.items")
// =======================================================
model Item {
  id        Int      @id @default(autoincrement()) @map("id")
  name      String   @map("name")
  quantity  Float?   @map("quantity")
  uom       String?  @map("uom")
  createdAt DateTime @default(now()) @map("created_at")

  auction   Auction  @relation(fields: [auctionId], references: [id])
  auctionId Int      @map("auction_id")

  @@map("items")
}
